<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Merry Christmas BaoNgan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
body{
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle at center,#1a0f14,#050204,#000);
  font-family:'Segoe UI',sans-serif;
}
#startBtn{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  padding:18px 64px;
  border-radius:40px;
  border:2px solid #ffd166;
  background:linear-gradient(145deg,#ff758f,#e63946);
  color:#fff;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 0 40px rgba(255,209,102,.8);
}
#hint{
  position:absolute;
  bottom:26px;
  width:100%;
  text-align:center;
  color:rgba(255,255,255,.65);
  font-size:13px;
  letter-spacing:1px;
}
</style>
</head>

<body>
<button id="startBtn">OPEN MAGIC ‚ú®</button>
<div id="hint">A Christmas gift for BaoNgan üéÑ</div>
<audio id="bgm" src="./music.mp3" loop></audio>

<script>
let scene,camera,renderer;
let portal,photos=[],snow;
let t=0;

const images=['image1.jpg','image2.jpg','image3.jpg','image4.jpg','image5.jpg'];

document.getElementById('startBtn').onclick=()=>{
  document.getElementById('startBtn').style.display='none';
  document.getElementById('bgm').play().catch(()=>{});
  init();
};

function init(){
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
  camera.position.z=90;

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio,2));
  document.body.appendChild(renderer.domElement);

  createStars();
  createSnow();
  createHeartPortal();
  createPhotos();
  createText();
  animate();
}

function createStars(){
  const geo=new THREE.BufferGeometry();
  const arr=[];
  for(let i=0;i<1800;i++){
    arr.push((Math.random()-0.5)*900,(Math.random()-0.5)*900,(Math.random()-0.5)*900);
  }
  geo.setAttribute('position',new THREE.Float32BufferAttribute(arr,3));
  scene.add(new THREE.Points(geo,new THREE.PointsMaterial({color:0xfff1c1,size:1})));
}

function createSnow(){
  const geo=new THREE.BufferGeometry();
  const arr=[];
  for(let i=0;i<1200;i++){
    arr.push((Math.random()-0.5)*600,Math.random()*600,(Math.random()-0.5)*600);
  }
  geo.setAttribute('position',new THREE.Float32BufferAttribute(arr,3));
  snow=new THREE.Points(geo,new THREE.PointsMaterial({
    color:0xffffff,size:1.5,transparent:true,opacity:0.8
  }));
  scene.add(snow);
}

function createHeartPortal(){
  const pts=[];
  for(let i=0;i<2200;i++){
    const a=Math.random()*Math.PI*2;
    let x=16*Math.pow(Math.sin(a),3);
    let y=13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a);
    let z=(Math.random()-0.5)*14;
    pts.push(x*2.2,y*2.2,z);
  }
  const geo=new THREE.BufferGeometry();
  geo.setAttribute('position',new THREE.Float32BufferAttribute(pts,3));
  portal=new THREE.Points(geo,new THREE.PointsMaterial({
    color:0xff758f,size:2.2,transparent:true,opacity:0.95
  }));
  scene.add(portal);
}

function createPhotos(){
  const loader=new THREE.TextureLoader();
  images.forEach((src,i)=>{
    const mat=new THREE.MeshBasicMaterial({map:loader.load(src),transparent:true});
    const mesh=new THREE.Mesh(new THREE.PlaneGeometry(22,22),mat);
    mesh.position.z=-100-i*20;
    scene.add(mesh);
    photos.push(mesh);
  });
}

function createText(){
  const c=document.createElement('canvas');
  c.width=1024; c.height=256;
  const ctx=c.getContext('2d');
  ctx.font='bold 96px Segoe UI';
  ctx.textAlign='center';
  ctx.fillStyle='#fff1c1';
  ctx.shadowColor='#ffb703';
  ctx.shadowBlur=40;
  ctx.fillText('Merry Christmas, BaoNgan ‚ù§Ô∏è',512,155);
  const tex=new THREE.CanvasTexture(c);
  const mesh=new THREE.Mesh(
    new THREE.PlaneGeometry(95,24),
    new THREE.MeshBasicMaterial({map:tex,transparent:true})
  );
  mesh.position.set(0,-34,0);
  scene.add(mesh);
}

function animate(){
  requestAnimationFrame(animate);
  t+=0.01;

  portal.rotation.y+=0.002;
  const beat=1+Math.sin(t*2)*0.05;
  portal.scale.set(beat,beat,beat);

  const snowPos=snow.geometry.attributes.position.array;
  for(let i=1;i<snowPos.length;i+=3){
    snowPos[i]-=0.3;
    if(snowPos[i]<-300) snowPos[i]=300;
  }
  snow.geometry.attributes.position.needsUpdate=true;

  photos.forEach((p,i)=>{
    p.position.z+=0.25;
    p.position.x=Math.sin(t+i)*30;
    p.position.y=Math.cos(t*0.8+i)*14;
    if(p.position.z>80) p.position.z=-110;
    p.lookAt(camera.position);
  });

  renderer.render(scene,camera);
}

window.onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
